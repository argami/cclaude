#!/bin/bash
# cclaude - Claude Code wrapper for multiple providers
# Usage: cclaude <provider> [claude args...]
# Providers: mimo, minimax, kimi, glm, claude (or none for default)

PROVIDER="$1"

case "$PROVIDER" in
  mimo)
    shift
    export ANTHROPIC_BASE_URL="https://api.xiaomimimo.com/anthropic"
    export MAIN_MODEL="mimo-v2-flash"
    export ANTHROPIC_AUTH_TOKEN="$MIMO_API_KEY"
    export ANTHROPIC_DEFAULT_OPUS_MODEL="$MAIN_MODEL"
    ;;
  minimax)
    shift
    export ANTHROPIC_BASE_URL="https://api.minimax.io/anthropic"
    export MAIN_MODEL="MiniMax-M2.1"
    export ANTHROPIC_AUTH_TOKEN="$MINIMAX_API_KEY"
    export ANTHROPIC_DEFAULT_OPUS_MODEL="$MAIN_MODEL"
    ;;
  kimi)
    shift
    export ANTHROPIC_BASE_URL="https://api.kimi.com/coding/"
    export MAIN_MODEL="kimi-k2-0711-preview"
    export ANTHROPIC_AUTH_TOKEN="$KIMI_API_KEY"
    export ANTHROPIC_DEFAULT_OPUS_MODEL="kimi-k2-thinking-turbo"
    ;;
  glm)
    shift
    export ANTHROPIC_BASE_URL="https://api.z.ai/api/anthropic"
    export MAIN_MODEL="glm-4.7"
    export ANTHROPIC_AUTH_TOKEN="$GLM_API_KEY"
    export ANTHROPIC_DEFAULT_OPUS_MODEL="$MAIN_MODEL"
    ;;
  claude|"")
    # Native Claude - no env changes, pass everything through
    [[ "$PROVIDER" == "claude" ]] && shift
    exec claude "$@"
    ;;
  *)
    # Unknown provider - assume it's a claude argument
    exec claude "$@"
    ;;
esac

# Common env vars for all alternative providers
export ANTHROPIC_API_KEY=""
export ANTHROPIC_MODEL="$MAIN_MODEL"
export ANTHROPIC_DEFAULT_SONNET_MODEL="$MAIN_MODEL"
export ANTHROPIC_DEFAULT_HAIKU_MODEL="$MAIN_MODEL"
export CLAUDE_CODE_SUBAGENT_MODEL="$MAIN_MODEL"
export DISABLE_NON_ESSENTIAL_MODEL_CALLS=1
export CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC=1
export API_TIMEOUT_MS=3000000

exec claude "$@"
